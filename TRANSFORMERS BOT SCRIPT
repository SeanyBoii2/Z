-- LocalScript --- BotHitbox fixer (locked version, lightweight)
local Workspace = game:GetService("Workspace")
local CollectionService = game:GetService("CollectionService")

-- ===== CONFIG =====
local TARGET_NAME = "BotHitbox"
local TARGET_SIZE = Vector3.new(15, 15, 15)
local TARGET_TRANSPARENCY = 1
local TARGET_COLOR = Color3.fromRGB(0, 0, 255) -- blue
local DEBUG = false

-- ===== internal cache =====
local processed = {} -- [Instance] = connection table

local function debugPrint(...)
	if DEBUG then
		print("[BotHitboxFixer]", ...)
	end
end

local function safeSetProperty(obj, prop, value)
	pcall(function()
		obj[prop] = value
	end)
end

-- ===== ensure all properties are correct =====
local function enforceProperties(part)
	safeSetProperty(part, "Transparency", TARGET_TRANSPARENCY)
	safeSetProperty(part, "Color", TARGET_COLOR)
	safeSetProperty(part, "Size", TARGET_SIZE)
	safeSetProperty(part, "CanCollide", false)
	pcall(function() part.Massless = true end)
end

-- ===== property watcher setup =====
local function lockProperties(part)
	if processed[part] then return end
	processed[part] = {}

	enforceProperties(part)

	-- reapply properties if changed
	local function watch(prop)
		local conn = part:GetPropertyChangedSignal(prop):Connect(function()
			local ok, current = pcall(function() return part[prop] end)
			if ok then
				if prop == "Color" and (part.Color - TARGET_COLOR).Magnitude > 0.001 then
					safeSetProperty(part, "Color", TARGET_COLOR)
				elseif prop == "Size" and part.Size ~= TARGET_SIZE then
					safeSetProperty(part, "Size", TARGET_SIZE)
				elseif prop == "Transparency" and part.Transparency ~= TARGET_TRANSPARENCY then
					safeSetProperty(part, "Transparency", TARGET_TRANSPARENCY)
				elseif prop == "CanCollide" and part.CanCollide ~= false then
					safeSetProperty(part, "CanCollide", false)
				elseif prop == "Massless" and part.Massless ~= true then
					pcall(function() part.Massless = true end)
				end
			end
		end)
		table.insert(processed[part], conn)
	end

	watch("Transparency")
	watch("Color")
	watch("Size")
	watch("CanCollide")
	watch("Massless")

	debugPrint("locked:", part:GetFullName())
end

local function unlockProperties(part)
	if not processed[part] then return end
	for _, conn in ipairs(processed[part]) do
		conn:Disconnect()
	end
	processed[part] = nil
	debugPrint("unlocked:", part:GetFullName())
end

-- ===== main config =====
local function configurePart(part)
	if not part or not part:IsA("BasePart") then return end
	if part.Name:lower() ~= TARGET_NAME:lower() then return end
	if not part:IsDescendantOf(Workspace) then return end

	lockProperties(part)
end

-- ===== event hooks =====
task.defer(function()
	for _, obj in ipairs(Workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name:lower() == TARGET_NAME:lower() then
			configurePart(obj)
		end
	end

	for _, tagged in ipairs(CollectionService:GetTagged(TARGET_NAME)) do
		if tagged:IsA("BasePart") then
			configurePart(tagged)
		end
	end
end)

Workspace.DescendantAdded:Connect(function(obj)
	if obj:IsA("BasePart") and obj.Name:lower() == TARGET_NAME:lower() then
		configurePart(obj)
	elseif obj:IsA("Model") or obj:IsA("Folder") then
		task.defer(function()
			for _, desc in ipairs(obj:GetDescendants()) do
				if desc:IsA("BasePart") and desc.Name:lower() == TARGET_NAME:lower() then
					configurePart(desc)
				end
			end
		end)
	end
end)

Workspace.DescendantRemoving:Connect(function(obj)
	unlockProperties(obj)
end)

CollectionService:GetInstanceAddedSignal(TARGET_NAME):Connect(function(obj)
	if obj and obj:IsA("BasePart") then
		configurePart(obj)
	end
end)

CollectionService:GetInstanceRemovedSignal(TARGET_NAME):Connect(function(obj)
	unlockProperties(obj)
end)

debugPrint("BotHitbox fixer started (client, property-locked)")
